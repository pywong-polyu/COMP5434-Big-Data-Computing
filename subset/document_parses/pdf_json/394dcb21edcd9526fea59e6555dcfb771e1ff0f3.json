{
    "paper_id": "394dcb21edcd9526fea59e6555dcfb771e1ff0f3",
    "metadata": {
        "title": "Development and assessment of a machine learning tool for predicting emergency admission in Scotland",
        "authors": [
            {
                "first": "James",
                "middle": [],
                "last": "Liley",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Gergo",
                "middle": [],
                "last": "Bohner",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Samuel",
                "middle": [
                    "R"
                ],
                "last": "Emerson",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Durham University",
                    "location": {
                        "settlement": "Durham",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Bilal",
                "middle": [
                    "A"
                ],
                "last": "Mateen",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Katie",
                "middle": [],
                "last": "Borland",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "David",
                "middle": [],
                "last": "Carr",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Scott",
                "middle": [],
                "last": "Heald",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Samuel",
                "middle": [
                    "D"
                ],
                "last": "Oduro",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Jill",
                "middle": [],
                "last": "Ireland",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Keith",
                "middle": [],
                "last": "Moffat",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Rachel",
                "middle": [],
                "last": "Porteous",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Stephen",
                "middle": [],
                "last": "Riddell",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Public Health Scotland (PHS)",
                    "location": {}
                },
                "email": ""
            },
            {
                "first": "Nathan",
                "middle": [],
                "last": "Cunningham",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Chris",
                "middle": [],
                "last": "Holmes",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Katrina",
                "middle": [],
                "last": "Payne",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Sebastian",
                "middle": [
                    "J"
                ],
                "last": "Vollmer",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Catalina",
                "middle": [
                    "A"
                ],
                "last": "Vallejos",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            },
            {
                "first": "Louis",
                "middle": [
                    "J M"
                ],
                "last": "Aslett",
                "suffix": "",
                "affiliation": {
                    "laboratory": "",
                    "institution": "Alan Turing Institute",
                    "location": {
                        "settlement": "London",
                        "country": "UK"
                    }
                },
                "email": ""
            }
        ]
    },
    "abstract": [
        {
            "text": "Avoiding emergency hospital admission (EA) is advantageous to individual health and the healthcare system. We develop a statistical model estimating risk of EA for most of the Scottish population (> 4.8M individuals) using electronic health records, such as hospital episodes and prescribing activity. We demonstrate good predictive accuracy (AUROC 0.80), calibration and temporal stability. We find strong prediction of respiratory and metabolic EA, show a substantial risk contribution from socioeconomic decile, and highlight an important problem in model updating. Our work constitutes a rare example of a population-scale machine learning score to be deployed in a healthcare setting.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "Emergency hospital admission (EA) -the event in which an individual is admitted to a hospital in an unplanned way -indicates an unforeseen decline in an individual's health: for instance, loss of control over disease state, breakdown of mental health, infection or trauma. Modern health and social care policies aim to reduce EA by preventing it through proactive strategies [3]. EA can often be avoided by appropriate primary care intervention [22, 26, 9]. Hence, machine learning (ML) approaches to determine EA risk for each patient may be of value to primary care practitioners [16] , particularly through identifying moderate-risk patients who are not already prioritised. The recent COVID-19 pandemic has further highlighted the need for rapid identification of populations at risk of needing acute health services, and directing preventive interventions such as shielding.",
            "cite_spans": [
                {
                    "start": 445,
                    "end": 449,
                    "text": "[22,",
                    "ref_id": "BIBREF21"
                },
                {
                    "start": 582,
                    "end": 586,
                    "text": "[16]",
                    "ref_id": "BIBREF15"
                }
            ],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "A range of models have been developed to predict EA from routinely-collected electronic health records (EHR) [25, 21, 30, 7]. However, transferability of predictive models across temporal and geographical settings is limited both due to differing demographics and differences in data availability [30]. Development of models in the setting they will eventually be used is thus typically preferable to reapplication of models trained in different settings. Here, we focus on SPARRA (Scottish Patients At Risk of Re-admission and Admission) -a model developed by the Information Services Division of the National Services Scotland (now incorporated into Public Health Scotland; PHS) to predict EA risk in the Scottish population [1]. To date, three versions of SPARRA have been deployed, with the target population increasing from only people aged 65 and older who had already had an EA in the past 3 years (version 1, 2006) to essentially the entire Scottish population (version 3, 2012). Every month, the predicted risk for each patient is shared with general practitioners (GPs). GPs are given incentives to take action on patients with an estimated EA probability between 40 and 60%. It is assumed those with an estimated EA probability between 61-99% are already known to GPs; however, there may be patients in that score range who GPs are unaware of and who would benefit from review. SPARRA version 3 (v3) scores are also used for planning in Health Boards, Health and Social Care Partnerships and academic research projects. The SPARRA v3 model was derived from national EHR databases including emergency and elective admissions, day cases, outpatient attendances, accident and emergency (A&E) attendances, and community prescribing records. Most long term conditions are flagged from hospital inpatient records alone (e.g. asthma), while other long term conditions are flagged from hospital inpatient records and/or community prescribing records (e.g. evidence of epilepsy). SPARRA v3 uses separate logistic regressions on three subcohorts of individuals: frail elderly conditions (FEC; individuals aged > 75); long-term conditions (LTC; individuals aged <75 with prior healthcare system contact) and young emergency department (YED; individuals aged <55 who have had at least one A&E attendance in the previous year). If an individual belongs to more than one of these groups, the maximum between the associated scores is reported. SPARRA v3 was fitted once (at its inception) with regression coefficients remaining fixed thereafter.",
            "cite_spans": [
                {
                    "start": 114,
                    "end": 117,
                    "text": "21,",
                    "ref_id": "BIBREF20"
                }
            ],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "In this work, we develop SPARRA version 4 (v4), using contemporary supervised and unsupervised ML methods using the same input data sources available for SPARRA v3. Our goal is two-fold: to improve predictive performance and calibration whilst using more contemporary data as input. Our data set comprises around 4.5 million individuals across seven time points (years), with a total of around 30 million individual-time observations. We validate SPARRA v4 using three-fold cross-validation, and evaluate the stability of the model and behaviour of risk scores across time. We examine the predictive model to determine the types of admission most readily predictable, and the effect of age and deprivation (measured by Scottish Index of Multiple Deprivation (SIMD) decile [15]) on risk scores. We use Shapley values [20] to partition individual risk scores: to ascertain the most important overall predictors and to assess potentially non-linear contributions to the overall risk.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "By updating an already-deployed model, our work highlights a critical problem in this area [19] . Since SPARRA v3 is already visible to GPs (who may intervene to lower the risk of high-risk patients), SPARRA v3 can alter the observed risk in the training data used for SPARRA v4 and the score can become a 'victim of its own success' [18, 27]. This is potentially hazardous: if some risk factor R confers high v3 scores and the score prompts GP intervention (for instance, enhanced follow-up), then from the point of view of training data for v4, R no longer confers increased risk. Should v4 be used in place of v3, some individuals would therefore have their EA risk underestimated, potentially diverting important anticipatory care away from them. As a solution to this critical issue, we propose to use v4 as an adjuvant to v3, rather than a naive model replacement.",
            "cite_spans": [
                {
                    "start": 91,
                    "end": 95,
                    "text": "[19]",
                    "ref_id": "BIBREF18"
                },
                {
                    "start": 334,
                    "end": 338,
                    "text": "[18,",
                    "ref_id": "BIBREF17"
                }
            ],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "Beyond merely developing a new predictive model, an important additional contribution of this work is in demonstrating practicalities in model delivery, as SPARRA v4 will be deployed across all of Scotland. Privacy considerations in use of EHR data required all model fitting to be performed on secure servers, with limited computational power and software availability. We describe the challenges arising in this context and how we adopted reproducible research practices. Finally, to ensure long-term use and maintenance of SPARRA v4, the project necessitated close collaboration between PHS staff and other authors, with regular knowledge transfer between them. Our work therefore provides a wider framework to support future collaboration between PHS and academia, demonstrating and resolving a range of challenges in in-vivo ML models in healthcare.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "RESULTS",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Abstract"
        },
        {
            "text": "The samples in our data consist of (patient,time) pairs (Figure 1a) . The patients included the majority of the Scottish population (\u2248 80%) across three time cutoffs: 1 May and 1 December 2016, and 1 May 2017. Our raw data was in the form of patient databases routinely collected by PHS (Figure 1b, Supplementary Table 1) . A patient-time pair was included in our study cohort if the patient was alive at the time cutoff, the patient had a healthcare interaction recorded in at least one of the source EHR tables prior to the time cutoff (Supplementary Table 1 ), and the patient had a valid SPARRA v3 score at the time cutoff (see inclusion criteria for SPARRA v3 [1] ). An EA was deemed to have occurred for a given individual and time cutoff if, in the year following the time cutoff, the individual either had a recorded emergency admission to a hospital in Scotland or died. (Supplementary Note 2) . Our total dataset comprised 5,829,532 unique individuals, 16,142,279 potential (patient,time) pairs, and 443,566,149 recorded interactions with the healthcare system (not including recorded deaths). After exclusions, our cohort comprised 4,870,488 unique individuals and 12,957,648 (patient,time) pairs, in which there were 1,163,520 EA events (9%). Demographics (age, sex, SIMD) of individuals in each source table, in the whole dataset, in our study cohort and stratified by EA status are shown in Figure 1b . A breakdown of demographics across these patient cohorts is shown in Figure 1c . Overall, we observe that our study cohort is slightly older, has a higher percentage of females, and is moderately more deprived than the population in general. When stratifying our study cohort between patients with and without EA, we observed that patients with an EA tend to be older and have a lower socioeconomic status.",
            "cite_spans": [
                {
                    "start": 665,
                    "end": 668,
                    "text": "[1]",
                    "ref_id": "BIBREF0"
                }
            ],
            "ref_spans": [
                {
                    "start": 56,
                    "end": 67,
                    "text": "(Figure 1a)",
                    "ref_id": null
                },
                {
                    "start": 287,
                    "end": 321,
                    "text": "(Figure 1b, Supplementary Table 1)",
                    "ref_id": null
                },
                {
                    "start": 538,
                    "end": 560,
                    "text": "(Supplementary Table 1",
                    "ref_id": null
                },
                {
                    "start": 880,
                    "end": 902,
                    "text": "(Supplementary Note 2)",
                    "ref_id": null
                },
                {
                    "start": 1405,
                    "end": 1414,
                    "text": "Figure 1b",
                    "ref_id": null
                },
                {
                    "start": 1486,
                    "end": 1495,
                    "text": "Figure 1c",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        },
        {
            "text": "We transformed source EHR tables to a design matrix (Figure 1a , Online Methods). For each patient, information from up to three years before the time cutoff was considered when building the input predictors, with the exception of long-term condition records, where information from ten years before the time cutoff was used. Most predictors were either counts of previous events (e.g. number of respiratory related prescriptions, number of long-term conditions), amount of time since most recent events (e.g. years since last EA) or binary indicators (e.g. diagnosis of multiple sclerosis). A list and description of derived predictors is provided in Supplementary Table 2. These predictors were augmented with engineered features using a topic model [5] which aggregates community prescription and long-term conditions data into thirty 'topics', roughly coding for classes of conditions or multimorbidity. We included the probability of membership for each of these topics as additional predictors in our model (Online Methods). The only predictors with missing values were SIMD (0.67% missingness) and topic features (0.82% missingness), the latter arising when individuals had hospital records but no filled prescriptions or recorded long-term conditions. Treatment of missing values is described in the Online Methods.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 52,
                    "end": 62,
                    "text": "(Figure 1a",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        },
        {
            "text": "For the prediction task, we considered an ensemble of a range of constituent model types, building model comparison into our validation procedure (see Supplementary Note 3). We used three-fold cross validation, randomly selecting patients to be included in each fold (Figure 1a ). In each cross-validation stage, a random one-third of patients were excluded from model fitting and used as a test set. Our cross-validation scheme was designed such that all constituents of the model evaluated on that test set were agnostic to samples in that test set (Online methods, Supplementary Figure 1, Supplementary Note 3) .",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 267,
                    "end": 277,
                    "text": "(Figure 1a",
                    "ref_id": null
                },
                {
                    "start": 568,
                    "end": 613,
                    "text": "Supplementary Figure 1, Supplementary Note 3)",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        },
        {
            "text": "The ultimate goal for this project is to produce SPARRA v4, an updated risk prediction score that can be deployed by PHS and used by GPs across Scotland (Figure 1a ). However, since SPARRA v3 is already universally deployed in Scotland with an unknown degree of use, we needed to take particular care in the process of updating v3 to v4. Namely, if v4 were to naively replace v3, individuals who were intervened on in response to v3 may be assigned inappropriately low scores by v4 [18, 27, 19] . To avoid this problem, we propose to deploy the maximum of v3 and v4 to GPs, which averts this potential danger at the cost of a small decrease in calibration. See Online Methods for further details.",
            "cite_spans": [
                {
                    "start": 482,
                    "end": 486,
                    "text": "[18,",
                    "ref_id": "BIBREF17"
                },
                {
                    "start": 491,
                    "end": 494,
                    "text": "19]",
                    "ref_id": "BIBREF18"
                }
            ],
            "ref_spans": [
                {
                    "start": 153,
                    "end": 163,
                    "text": "(Figure 1a",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        },
        {
            "text": "We compared the predictive performance of SPARRA v3 and SPARRA v4 (Figure 2a,2b) . In test sets, the SPARRA v4 model was effective at predicting EA, and stronger than SPARRA v3 on the basis of AUROC (SPARRA v4: 0.801; SE < 3 \u00d7 10 \u22124 , vs SPARRA v3: 0.781 ; SE < 3 \u00d7 10 \u22124 ) and AUPRC (SPARRA v4: 0.402; SE < 5 \u00d7 10 \u22124 , vs SPARRA v3: 0.359; SE < 5 \u00d7 10 \u22124 ). SPARRA v4 was also better calibrated (Figure 2c) .",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 66,
                    "end": 80,
                    "text": "(Figure 2a,2b)",
                    "ref_id": null
                },
                {
                    "start": 396,
                    "end": 407,
                    "text": "(Figure 2c)",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        },
        {
            "text": "The apparently subtle differences in performance between v3 and v4 are substantial when considered in terms of real-world consequences. Amongst the 50,000 individuals judged to be at highest EA risk by SPARRA v3, around 4,000 fewer individuals were eventually admitted than were amongst the 50,000 individuals judged to be at highest risk by SPARRA v4 (Figure 2d ). If we assume that 20% of admissions are avoidable [6] and assume that avoidable admissions are as predictable as non-avoidable admissions (which may be conservative, as avoidable admissions are more likely to be pre-empted by other medical problems and hence be predictable), then in order to preempt 3,000 avoidable admissions by targeting the highest risk patients under SPARRA v4, we would need to intervene for approximately 1,500 fewer patients than when using v3 in the same way ( Figure 2e) .",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 352,
                    "end": 362,
                    "text": "(Figure 2d",
                    "ref_id": null
                },
                {
                    "start": 853,
                    "end": 863,
                    "text": "Figure 2e)",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        },
        {
            "text": "Finally, we evaluated the performance of max(v3, v4) -the practical solution proposed above to avoid the risks of naive model updating. As seen in Figure 2a,2b, there was a small change in predictive performance (sligthly lower AUROC; slightly 2 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 147,
                    "end": 160,
                    "text": "Figure 2a,2b,",
                    "ref_id": null
                }
            ],
            "section": "Abstract"
        }
    ],
    "body_text": [
        {
            "text": "higher AUPRC) and slightly attenuated calibration (Figure 2c) . A density plot of v3 and v4 scores is shown in Supplementary figure 5 . The performance of v4 may attenuate in a healthcare system where v3 is not in use [27, 18, 19] .",
            "cite_spans": [
                {
                    "start": 132,
                    "end": 133,
                    "text": "5",
                    "ref_id": null
                },
                {
                    "start": 218,
                    "end": 222,
                    "text": "[27,",
                    "ref_id": null
                },
                {
                    "start": 223,
                    "end": 226,
                    "text": "18,",
                    "ref_id": "BIBREF17"
                },
                {
                    "start": 227,
                    "end": 230,
                    "text": "19]",
                    "ref_id": "BIBREF18"
                }
            ],
            "ref_spans": [
                {
                    "start": 50,
                    "end": 61,
                    "text": "(Figure 2c)",
                    "ref_id": "FIGREF1"
                }
            ],
            "section": "INTRODUCTION"
        },
        {
            "text": "We found that the difference in performance (by AUROC) between v3 and v4 was higher in subcohorts of patients at high risk (age > 80) and at low risk (age 20 \u2212 70, no previous EA), with a smaller performance differential in the complement of these subcohorts (denoted as moderate risk, Figures 2f, 2g, 2h) . In high-and low-risk cohorts, general predictive accuracy (rather than differential) was lower than for the whole cohort (AUROC \u2248 0.7 for high-and low-risk subcohorts), suggesting that the differential performance of v4 was driven by improved performance on difficult-to-predict high-and low-risk samples, with more equivalent performance on easy-to-predict moderate-risk samples. In individuals for which v3 and v4 disagreed (|v3 \u2212 v4| > 0.1), we found that v4 was better-calibrated when v4 > v3 and equivocal to v3 when v3 > v4 (Figure 2i ).",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 286,
                    "end": 305,
                    "text": "Figures 2f, 2g, 2h)",
                    "ref_id": "FIGREF1"
                },
                {
                    "start": 838,
                    "end": 848,
                    "text": "(Figure 2i",
                    "ref_id": "FIGREF1"
                }
            ],
            "section": "Stratified performance of SPARRA v3 and SPARRA v4"
        },
        {
            "text": "To examine differences in performance more closely, we next explored the performance of SPARRA v3 and SPARRA v4 across different patient subcohorts defined by age, SIMD deciles and the three subcohorts defined as part of SPARRA v3 development. We noted that our model outperformed the existing score in terms of AUROC over all subcohorts (Figure 3a-c) . We also explored the performance of SPARRA v4 after stratifying different types of EA admissions. We found that our model was able to predict certain medical classes of admission disproportionately well (Figures 3d,3e) , namely predicting respiratory and endocrine/metabolic related admissions. As expected, we were less able to predict traumatic admissions, and admissions due to external causes of morbidity (ICD codes V00-Y99 [24] ). Supplementary figure 10 shows relative performance by type of admission (injury, referral etc), with slightly better performance for non-injury-related than injury-related admissions.",
            "cite_spans": [
                {
                    "start": 783,
                    "end": 787,
                    "text": "[24]",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 338,
                    "end": 351,
                    "text": "(Figure 3a-c)",
                    "ref_id": "FIGREF2"
                },
                {
                    "start": 557,
                    "end": 572,
                    "text": "(Figures 3d,3e)",
                    "ref_id": "FIGREF2"
                }
            ],
            "section": "Stratified performance of SPARRA v3 and SPARRA v4"
        },
        {
            "text": "When further analysing the risk scores predicted by SPARRA v4, we found that our model tends to better predict imminent admissions: individuals with high risk scores were more likely to have an EA near the start of the 1 year outcome period ( Figure 3f ). This was partly because individuals with a high risk score were disproportionately more likely to have multiple admissions ( Figure 3g ). However, amongst those with only one admission, individuals with a high SPARRA v4 score were also more likely to have an admission earlier in the year (Figure 3h ).",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 243,
                    "end": 252,
                    "text": "Figure 3f",
                    "ref_id": "FIGREF2"
                },
                {
                    "start": 381,
                    "end": 390,
                    "text": "Figure 3g",
                    "ref_id": "FIGREF2"
                },
                {
                    "start": 545,
                    "end": 555,
                    "text": "(Figure 3h",
                    "ref_id": "FIGREF2"
                }
            ],
            "section": "Stratified performance of SPARRA v3 and SPARRA v4"
        },
        {
            "text": "Using the same analysis pipeline as for SPARRA v4, we fitted a model M 0 to an early time cutoff (t 0 =1 May 2014), using only one year of data to derive predictors. We then assembled test matrices from data 1 year prior to the time points t 1 =1 May 2015, t 2 =1 Dec 2015, t 3 =1 May 2016, t 4 =1 Dec 2016, and t 5 =1 May 2017 and applied M 0 to predict EA in the year following each time point. This enabled assessment of how the performance of M 0 changed over time. In order to ensure a fair comparison, we compared performance on subsamples of 1 million individuals from time points t 1 \u2212 t 5 chosen such that global admission rates matched those at t 0 . We found that M 0 performed essentially equally well when used to predict admission following t 1 \u2212 t 5 , with no statistically significant decrease in performance (adjusted p-values > 0.05 or improved performance with time for all comparisons of AUROCs; Supplementary Figures 6a, 6c, 6b) .",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 916,
                    "end": 949,
                    "text": "Supplementary Figures 6a, 6c, 6b)",
                    "ref_id": "FIGREF17"
                }
            ],
            "section": "Stability over time"
        },
        {
            "text": "We then compared how well fixed predictions computed at t 0 performed over time. We subsampled individuals with complete data such that admission rates and age distributions at t 1 \u2212 t 5 matched those at t 0 , and assessed how well the initial scores predicted EA subsequent to t 1 \u2212 t 5 . We observed that the fixed scores performed reasonably well even 2-3 years after t 0 , although calibration was gradually lost (Figures 4a, 4b, 4c ). We also note that the fixed scores obtained at t 0 predicted the event 'any EA between t 1 and a year after t 5 ' with AUROC 0.84 (SE < 4 \u00d7 10 \u22124 ), higher than that achievable for predicting EA in one year periods. More generally, we observe that scores fitted and calculated at a fixed timepoint had successively lower AUROCs for predicting EA over future periods (Supplementary figure 8) .",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 417,
                    "end": 436,
                    "text": "(Figures 4a, 4b, 4c",
                    "ref_id": "FIGREF4"
                },
                {
                    "start": 806,
                    "end": 830,
                    "text": "(Supplementary figure 8)",
                    "ref_id": null
                }
            ],
            "section": "Stability over time"
        },
        {
            "text": "We then considered how individual scores changed amongst all patients with complete data at all time periods. We found that while quantiles of the distribution of scores at t 1 \u2212 t 5 increased as the cohort grew older (Figure 4d ), the mean risk scores of individuals in the highest centiles of risk at t 0 tended to decrease over time (Figure 4e ), suggesting that very high risk scores tend to be transient. We analysed this more closely by comparing bivariate densities of scores (Figure 4f and Supplementary Figure 7 ). We found that lower scores are more stable than higher scores over subsequent time points, and individuals 'jump' to higher scores (upper left in Figure 4f ) more than they drop to lower scores (bottom right). Amongst individuals with a given score at t 1 , median score at t 2 tends to be lower, although quantiles of the overall score distribution increase (Figures 4d and 4e ).",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 218,
                    "end": 228,
                    "text": "(Figure 4d",
                    "ref_id": "FIGREF4"
                },
                {
                    "start": 336,
                    "end": 346,
                    "text": "(Figure 4e",
                    "ref_id": "FIGREF4"
                },
                {
                    "start": 483,
                    "end": 493,
                    "text": "(Figure 4f",
                    "ref_id": "FIGREF4"
                },
                {
                    "start": 512,
                    "end": 520,
                    "text": "Figure 7",
                    "ref_id": "FIGREF18"
                },
                {
                    "start": 670,
                    "end": 679,
                    "text": "Figure 4f",
                    "ref_id": "FIGREF4"
                },
                {
                    "start": 883,
                    "end": 901,
                    "text": "(Figures 4d and 4e",
                    "ref_id": "FIGREF4"
                }
            ],
            "section": "Stability over time"
        },
        {
            "text": "We examined the contribution of predictors to risk scores at an individual level by estimating Shapley values [20] for each predictor/individual pair. The predictors with largest mean absolute Shapley value (excluding v3 and topic features) were age, the number of recorded long-term conditions, the number of previous A&E attendances, and the number of previous EAs (Table 5e ). Most predictors had non-linear effects (Supplementary Figures 14-20) .",
            "cite_spans": [
                {
                    "start": 110,
                    "end": 114,
                    "text": "[20]",
                    "ref_id": "BIBREF19"
                }
            ],
            "ref_spans": [
                {
                    "start": 367,
                    "end": 376,
                    "text": "(Table 5e",
                    "ref_id": null
                },
                {
                    "start": 419,
                    "end": 448,
                    "text": "(Supplementary Figures 14-20)",
                    "ref_id": "FIGREF1"
                }
            ],
            "section": "Predictor importance"
        },
        {
            "text": "We found a non-linear importance of age: the risk contribution from age was high in infancy, dropped rapidly through childhood, remained stable until around age 65, then rose rapidly, stabilising at around age 75 until death (Figure 5a) . We also found a non-linear importance of SIMD [13] (Figure 5b ) and number of previous emergency hospital admissions (Supplementary Figure 13) . We further investigated the contribution of SIMD by comparing Shapley values between variables. We computed the mean difference in contribution of SIMD to risk score between individuals in SIMD 10 areas (lowest deprivation) and SIMD 1 areas (highest deprivation), and the additional years of age which would contribute an equivalent amount. This was generally around 10-40 additional years (Figure 5c ). In terms of raw admission rates, disparity was further apparent: individuals aged 20 in SIMD 1 areas had similar admission rates to individuals aged 70 in SIMD 8-10 areas (Figure 5d ).",
            "cite_spans": [
                {
                    "start": 285,
                    "end": 289,
                    "text": "[13]",
                    "ref_id": null
                },
                {
                    "start": 356,
                    "end": 381,
                    "text": "(Supplementary Figure 13)",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 225,
                    "end": 236,
                    "text": "(Figure 5a)",
                    "ref_id": "FIGREF16"
                },
                {
                    "start": 290,
                    "end": 300,
                    "text": "(Figure 5b",
                    "ref_id": "FIGREF16"
                },
                {
                    "start": 774,
                    "end": 784,
                    "text": "(Figure 5c",
                    "ref_id": "FIGREF16"
                },
                {
                    "start": 959,
                    "end": 969,
                    "text": "(Figure 5d",
                    "ref_id": "FIGREF16"
                }
            ],
            "section": "Predictor importance"
        },
        {
            "text": "We assessed the added value of inclusion of topic-model derived features, which summarise more granular information about the previous medical history of a patient with respect to those included in SPARRA v3. For this purpose, we refitted model M 0 with topic-derived features excluded from the predictor matrix (model M 0 ). We compared the performance of M 0 and M 0 on a set of test data for time point t 1 . On comparison of AUROC curves, M 0 had a slightly better performance than M 0 , though the absolute AUROC difference was small (p-value = 6 \u00d7 10 \u221247 ; AUC 0.789 vs 0.788; Supplementary figure 12). Analogously to Figure 2 , we also computed the additional number of samples correctly identified as having an EA amongst the top scores by M 0 and M 0 , and found that use of M 0 over M 0 increased the number of EAs detected in the top 500,000 scores by around 200. Supplementary table 4 shows the most pertinent features (ICD10 codes and prescription types) for each topic in the model used for prediction on fold 1.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 624,
                    "end": 632,
                    "text": "Figure 2",
                    "ref_id": "FIGREF1"
                }
            ],
            "section": "Model analysis"
        },
        {
            "text": "Finally, we explored a breakdown of model performance (AUROCs, AUPRCs, and calibration curves) across the different model constituents included in our ensemble (Table 3, Figures 2, 3 , and 4). The performance of the ensemble was slightly better than the best constituent models (XG-boosted trees and random forests). Several constituent models (ANN, GLM, Naive Bayes) had vanishing coefficients in all ensembles, so predictions for these models need not be computed when generating SPARRA v4.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 160,
                    "end": 169,
                    "text": "(Table 3,",
                    "ref_id": "TABREF11"
                },
                {
                    "start": 170,
                    "end": 182,
                    "text": "Figures 2, 3",
                    "ref_id": "FIGREF1"
                }
            ],
            "section": "Model analysis"
        },
        {
            "text": "The SPARRA v4 model is a state-of-the-art risk prediction model for EA developed using routinely collected EHR data, optimised for use in the Scottish population. It augments and consistently outperforms the SPARRA v3 model that is currently in clinical use. Although the improvement on model metrics (AUROC, AUPRC) from SPARRA v3 to SPARRA v4 is small, this difference is highly meaningful in terms of absolute performance. More generally, we demonstrate that sophisticated machine learning methods can enable meaningful gains in performance in a real-world setting. In particular, to our knowledge, this is the first use of a topic model to summarise complex multi-morbidity data (captured by historic prescriptions and diagnosis) and an ensemble prediction approach in the context of EA prediction. We highlight a hazard of updating widely-circulated predictive scores, and discuss how machine leaning models can be deployed, an area of growing importance for health data science.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "We find a range of epidemiological associations with predictable EA risk. Both the tendency to predict imminent admissions and the relative instability of high risk scores with time indicate that SPARRA v4 is sensitive to short-term periods of high risk, particularly relating to respiratory, metabolic and mental-health related illness. The relationship between deprivation (SIMD) and EA risk is complex; SIMD includes a constituent of general health [13] , and individuals in low-SIMD areas are more likely to miss primary care appointments [12] suggesting a lower overall rate of primary care uptake. We do not assert causality for this or any other reported associations. In particular, we cannot make counterfactual predictions, and thus cannot directly recommend any changes to patient management which would lower EA risk. Furthermore, lowering of EA risk does not necessarily entail overall patient benefit. : for instance, long-term oral corticosteroid use in mild asthmatics would reduce EA risk at an unacceptable cost of long-term morbidity. actions taken to stabilise at-risk patients As such, any potential interventions should be carefully assessed by GPs and other members of the clinical team on a case-by-case basis.",
            "cite_spans": [
                {
                    "start": 452,
                    "end": 456,
                    "text": "[13]",
                    "ref_id": null
                },
                {
                    "start": 543,
                    "end": 547,
                    "text": "[12]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "We chose to code our target variable as EA in the subsequent year. This is not a universal choice in EA prediction [25, 30] , and targets such as survival time to admission may lead to different model properties and performance (noting that our model M 0 could predict next-three-year EA better than one-year). As well as the advantage of maintaining interpretability (a one-year EA probability was used in earlier versions of SPARRA) this target has the advantage of being independent of seasonal influences on EA frequency. Although a range of models have been proposed to predict EA, it is difficult to transfer information between geographic settings, since they are highly dependent on data collection protocols of healthcare systems [30]. We do not expect that our model will directly be used outside of Scotland. However, the design of our reproducible analysis pipeline is general and could be adapted to other settings. Performance of our model is weaker than that of a related model in England [25] , but this is unsurprising given reduced predictor availability in our study. In fact, data in [25] included primary care records and health indicators (body mass index, smoking status, laboratory tests). However, our model has the advantage of using only data routinely collected centrally at a national level by Scottish healthcare authorities (albeit not including records from GP practices), and can thus be computed for the general Scottish population without the need for any additional data collection.",
            "cite_spans": [
                {
                    "start": 115,
                    "end": 119,
                    "text": "[25,",
                    "ref_id": null
                },
                {
                    "start": 120,
                    "end": 123,
                    "text": "30]",
                    "ref_id": null
                },
                {
                    "start": 1004,
                    "end": 1008,
                    "text": "[25]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "As for any predictive model in this area, the question of of translation into clinical action in a way which optimally benefits the patient is a vital area of ongoing research, and is essential for quantifying the benefit of including such scores in clinical practice. To do this, EA risk scores must be comprehensive, accurate, and interpretable, which we have aimed for in SPARRA v4. The SPARRA v4 model will be deployed in the Scottish NHS, augmenting the SPARRA v3 model. We expect that the SPARRA score will be most useful to patients for whom anticipatory care plans are not already in place, and for whom GPs do not know well. For this reason, well calibrated risk scores are particularly important. We anticipate that the SPARRA v4 tool will contribute to the overall effectiveness of the Scottish NHS, and correspondingly to the health of the Scottish population. We will collaborate to achieve a successful deployment and will carefully consider the feedback from GPs to improve the model and the communication of its results further (e.g. via informative dashboards).",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "Ongoing work will evaluate the use of different target variable types, new machine learning methods, improved coverage of the Scottish population (SPARRA v4 only covers around 80% of the population and likely excludes healthy individuals with low engagement with the healthcare system), and translation to clinical action. As the COVID-19 pandemic resolves, it will also be important to assess potential effects of dataset shift [28], e.g. due to disproportionate mortality burden in older individuals and long term consequences of COVID-19 infections. We anticipate that robust and reproducible development of risk prediction scores such as SPARRA v4 will play an important role in the design of proactive interventions to manage future risk.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "5 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. [23] . This precedes our cohort by three years.",
            "cite_spans": [
                {
                    "start": 136,
                    "end": 140,
                    "text": "[23]",
                    "ref_id": "BIBREF22"
                }
            ],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "6 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. . Stratified performance of SPARRA v3 and v4. Panels 3a, 3b and 3c show difference in AUROC between v3 and v4 (red/black) and EA frequency (dashed lines) in subcohorts defined by age, SIMD and the original subcohorts defined during SPARRA v3 development (see Introduction), respectively. Panels 3d and 3e show SPARRA v4 performance by category of disease by ICD10 code (Abnormality NEC: abnormality not elsewhere classified; ). In panel 3d, bar height for a given particular x-axis category and a given colour (score threshold) is the proportion of individuals with EA reaching that score threshold admitted for that reason. Percentages sum to 100% across bars of each colour (score category) rather than disease category. A rising profile indicates relatively better prediction of this category. Panel 3e shows distribution of log-scores for individuals admitted in each class, with black points indicating the associated medians. Supplementary figure 11 shows equivalent data to panel 3d as positive-predictive values. Panel 3f shows the distribution of time-to-event after the first time cutoff amongst cohorts of individuals who 1) had an EA in the year following the time cutoff and 2) had a SPARRA v4 score above a given cutoff. Panel 3g shows the discrete distribution of number of events over the same cohorts. Panel 3h shows the distribution of time-to-event amongst cohorts of individuals who were admitted exactly once in the year following the first time cutoff.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 1082,
                    "end": 1091,
                    "text": "figure 11",
                    "ref_id": null
                }
            ],
            "section": "DISCUSSION"
        },
        {
            "text": "8 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. show performance of static predictions made for the early time point at estimating risk for later time points. Lower panels for ROC curves show differences between sensitivity at t i and at t 1 ; for PRC curves difference in PPV between t i and t 1 ; and for calibration curves the difference between observed and expected EA frequency. Pointwise 95% confidence intervals for calibration curves are shown only for the final time point for clarity. Panel 4d shows the change in distribution centiles (light blue) and deciles (dark blue) of risk scores with time, across all individuals with data available at all time points. Panel 4e considers cohorts of individual by risk centiles (light blue) and deciles (dark blue) at the first time point (2 May 2015) and tracks average risks of these cohorts over time. Panel 4f shows joint density (low to high: white-grey-red-yellow) of individual risk scores at t 1 (2 May 2015) and t 2 (1 Dec 2015). The density is normalised to uniform marginal on the Y axis, then the X axis; true marginal distributions of risk scores are shown alongside in grey. Figure 5 . Panels 5a, 5b and 13 show non-linear influence of age, SIMD, and number of previous elective (Elec.) and emergency (Em.) admissions on risk scores. Panel 5c shows the number of additional years of age needed to contribute as much to risk score as a SIMD 1-SIMD 10 difference. Panel 5d shows 'Effective ages' for each age: for an (age,SIMD) pair, the age at mean SIMD with the equivalent EA rate. Table 5e shows the 20 most important variables by mean absolute Shapley value (percentage scale). Importance can be interpreted as the average percent added or subtracted to risk score due to this factor. Also see supplementary table 2 and Supplementary Figures 14-20. 10 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [
                {
                    "start": 820,
                    "end": 832,
                    "text": "(2 May 2015)",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 1170,
                    "end": 1178,
                    "text": "Figure 5",
                    "ref_id": "FIGREF16"
                },
                {
                    "start": 1577,
                    "end": 1585,
                    "text": "Table 5e",
                    "ref_id": null
                },
                {
                    "start": 1791,
                    "end": 1845,
                    "text": "supplementary table 2 and Supplementary Figures 14-20.",
                    "ref_id": null
                }
            ],
            "section": "DISCUSSION"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DISCUSSION"
        },
        {
            "text": "A typical entry in the source EHR tables (Supplementary Table 1 ) recorded a single interaction between an individual and NHS Scotland (e.g. hospitalisation), with each record comprising a unique identifier (ID) for the individual, the date on which the interaction was initiated (admission), the date it ended (discharge), and details of the interaction (diagnoses made, procedures performed). We generated input features by scanning source tables for records corresponding to each ID-time pair. For each individual, we considered all records from up to three years before the time cutoff.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 41,
                    "end": 63,
                    "text": "(Supplementary Table 1",
                    "ref_id": null
                }
            ],
            "section": "Feature engineering"
        },
        {
            "text": "Most input predictors were similar to those used for SPARRAv3 [1] . See Supplementary Table 2 for a full list of predictors. In terms of demographics, we included age, sex, and SIMD decile (the latter serving to use using geographic-level deprivation as a proxy for individual-level deprivation). Other input predictors include counts of previous admissions (e.g. A&E admissions, drug-and-alcohol related admissions), and the amount of time spent in hospital (e.g. emergency bed days). Following findings in [25] , where possible, we also included predictors encoding time-since-last-event (e.g. days since last outpatient attendance). From community prescribing data, we used predictors encoding the number of prescriptions for various pre-specified types (e.g. respiratory), as well as the total number of different types of prescriptions, number of paid prescription items, and total amount spent on prescriptions. From data on long-term conditions, we evaluated recorded presence of a long term condition (eg. multiple sclerosis, epilepsy), the number of years since diagnosis of a range of long-term conditions (e.g. asthma), the total number of long-term conditions recorded, and the number of long-term conditions resulting in hospital admissions.",
            "cite_spans": [
                {
                    "start": 62,
                    "end": 65,
                    "text": "[1]",
                    "ref_id": "BIBREF0"
                },
                {
                    "start": 508,
                    "end": 512,
                    "text": "[25]",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 86,
                    "end": 93,
                    "text": "Table 2",
                    "ref_id": null
                }
            ],
            "section": "Feature engineering"
        },
        {
            "text": "In addition to the predictors listed above, we used a Latent Dirichlet Allocation (LDA)-based topic model [5] to derive more information from prescriptions and long-term condition data. We jointly modelled prescriptions and long-term conditions using 30 topics, considering samples as 'documents' and conditions/prescriptions as 'words'. We retained the map from documents to topic probabilities, and used derived topic probabilities as input variables for our model. Document to topic probability maps were fitted only to the training set of data, and applied to test set data when evaluating accuracy.",
            "cite_spans": [
                {
                    "start": 106,
                    "end": 109,
                    "text": "[5]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Feature engineering"
        },
        {
            "text": "A range of other predictors are known to influence EA. In particular, an English study found that marital and smoking status, blood test parameters and family histories were highly predictive [25] . However, these were not included in our data which only contains information that is routinely collected in secondary care. In addition, due to privacy considerations, we did not have access to geographic location data. We would expect that patterns of EA risk would vary between rural and urban areas of Scotland, and this variation may be substantial given the geographic diversity of the region. As well as being unable to use geographic location as a predictor, this precluded the use of a geographically separated test set [30] .",
            "cite_spans": [
                {
                    "start": 192,
                    "end": 196,
                    "text": "[25]",
                    "ref_id": null
                },
                {
                    "start": 727,
                    "end": 731,
                    "text": "[30]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Unavailable predictors"
        },
        {
            "text": "We had little cause to believe in advance that any particular class of models would be best for this problem. Thus, we considered a range of model types. Rather than selecting and using only the best performing model, we chose an ensemble defined as an optimal linear combination of model outputs (L 1 -penalised regression) in a similar way to Van der Laan (2007) [29] . Compared to choosing only one model, this slightly increases the range of predictor functions which are able to be modelled, slightly improves prediction, and reduces reliance on behaviour of a single model type, at the cost of a small number of additional degrees of freedom. We monotonically transformed the ensemble predictor to improve calibration by inverting the empirical calibration function (see Supplementary note 3 for details).",
            "cite_spans": [
                {
                    "start": 365,
                    "end": 369,
                    "text": "[29]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Machine learning prediction methods"
        },
        {
            "text": "As part of the ensemble, we considered a variety of constituent (base) models. These include an artificial neural network (ANN) [17] , two random forests (RF) [17] (one shallow, of depth 20, and one deep, of depth 40), three gradient boosted trees (XGB) [8] (of maximum constituent tree depth 3,4, and 8), a generalised linear model (GLM) [17] , a naive Bayes model (NB) [17] , and the model used in SPARRA v3 (v3) [1] ). Full details of these models are given in the Supplementary Note 1.",
            "cite_spans": [
                {
                    "start": 128,
                    "end": 132,
                    "text": "[17]",
                    "ref_id": null
                },
                {
                    "start": 159,
                    "end": 163,
                    "text": "[17]",
                    "ref_id": null
                },
                {
                    "start": 254,
                    "end": 257,
                    "text": "[8]",
                    "ref_id": null
                },
                {
                    "start": 339,
                    "end": 343,
                    "text": "[17]",
                    "ref_id": null
                },
                {
                    "start": 371,
                    "end": 375,
                    "text": "[17]",
                    "ref_id": null
                },
                {
                    "start": 415,
                    "end": 418,
                    "text": "[1]",
                    "ref_id": "BIBREF0"
                }
            ],
            "ref_spans": [],
            "section": "Machine learning prediction methods"
        },
        {
            "text": "Since all non-primary care interactions with NHS Scotland are recorded in the input databases, there was no missingness for most predictors. For 'time-since-interaction' type predictors, individual-time pairs for which there was no recorded interaction were coded as the maximum lookback time. There was some missingness in SIMD records (\u223c0.7%), possibly due to individuals without a fixed address, and in topic features (\u223c0.8%). In both cases, missingness would be expected to be non-random and possibly informative. We thus managed predictor missingness in different ways across constituent models. We used mean-value imputation in the ANN and GLM models (deriving mean values from training data only), used missingness to inform tree splits (defaults in [17] ) in RF, used sample-wise imputation in XGB (as per [8] ) and dropped during fitting (default in [17] ) in NB (omitted missing values for prediction).",
            "cite_spans": [
                {
                    "start": 757,
                    "end": 761,
                    "text": "[17]",
                    "ref_id": null
                },
                {
                    "start": 814,
                    "end": 817,
                    "text": "[8]",
                    "ref_id": null
                },
                {
                    "start": 859,
                    "end": 863,
                    "text": "[17]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Missing values"
        },
        {
            "text": "We optimised various metrics for constituent models, which were generally the default in the relevant functions. For the ANN, RFs and GLM, we minimised log-loss; for the NB model, likelihood; and for the XGB trees, a logistic objective. For fitting model weights in the ensemble ensemble, we optimised area under an ROC curve (AUROC) as a metric for model fit.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Predictive performance"
        },
        {
            "text": "Although our primary endpoint for model performance was AUROC, we also considered area-under-precision-recall curve and calibration curves for visualisation of results. We plotted calibration curves using a kernelised calibration estimator; see Supplementary Note 5. We compared the performance of predictive models with and without topic features by evaluating AUROCs for prediction on a given year, and compared AUROCs using DeLong's test [11] .",
            "cite_spans": [
                {
                    "start": 441,
                    "end": 445,
                    "text": "[11]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Predictive performance"
        },
        {
            "text": "For simplicity, figures show ROC/PR curves for combined cross-validation folds (that is, given fold-wise prediction\u015d",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Predictive performance"
        },
        {
            "text": "and similarly for PR curves). Quoted AUROC/AUPRC values are means over folds (that is, 1 3 ",
            "cite_spans": [
                {
                    "start": 87,
                    "end": 90,
                    "text": "1 3",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Predictive performance"
        },
        {
            "text": ", which averts problems from between-fold differences in models [14] . For fairness of comparison, we also used mean-over-folds to compute quoted AUROCs and AUPRCs for SPARRA v3, although SPARRA v3 was not fitted to our data.",
            "cite_spans": [
                {
                    "start": 64,
                    "end": 68,
                    "text": "[14]",
                    "ref_id": "BIBREF13"
                }
            ],
            "ref_spans": [],
            "section": "Predictive performance"
        },
        {
            "text": "We fitted and evaluated the model using three-fold cross-validation (see supplementary Figure 1 ). Each third of the data was used as a training, validation and test set in turn. The full dependency structure is shown in supplementary figure 1. For each fold, the prediction function used was independent of data in that fold. A full description of the cross-validation procedure is given in Supplementary note 3.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 87,
                    "end": 95,
                    "text": "Figure 1",
                    "ref_id": null
                }
            ],
            "section": "Cross-validation"
        },
        {
            "text": "Our aim in producing the SPARRA score is to produce an accurate estimate of EA risk in the coming year under normal medical care. In other words, the score should represent the true EA risk if the score was not visible to the GPs. Because GPs see the score and may act on it, the observed risk may be lower than predicted -the score may become a 'victim of its own success' [18, 27] . Unfortunately, since the SPARRA v3 score is universally available to GPs, and may be acted on, we cannot assess the behaviour of the medical system in its absence. As illustrated in [19] , this is potentially hazardous.",
            "cite_spans": [
                {
                    "start": 374,
                    "end": 378,
                    "text": "[18,",
                    "ref_id": "BIBREF17"
                },
                {
                    "start": 379,
                    "end": 382,
                    "text": "27]",
                    "ref_id": null
                },
                {
                    "start": 567,
                    "end": 571,
                    "text": "[19]",
                    "ref_id": "BIBREF18"
                }
            ],
            "ref_spans": [],
            "section": "Model updating"
        },
        {
            "text": "Formally, at a given fixed time, for each individual, EA in the next 12 months is a Bernoulli random variable. The probability of the event for individual i is modelled conditional on a set of covariates X i derived from their EHR. We denote v3(X i ), v4(X i ) the derived SPARRA v3 and v4 scores as functions of covariates, and assume a causal structures shown in Figure 6 . With no SPARRA-like predictive score in place, there is only one causal pathway X i \u2192 EA ( Figure 6A ). It is to this system (coloured red) that v3 was fitted. In this setting, v3(X i ) is an estimator of the 'native' risk Pr(EA|X i ) (this ignores the effect of previous versions of the SPARRA score, which covered less than 30% of the Scottish population). Although v3(X i ) is determined entirely by X i , the act of calculating and distributing values of v3(X i ) to GPs opens a second causal pathway from X i to EA ( Figure 6B ). This is driven by GP interventions made in response to v3(X i ) scores. It is to this system (coloured red) that SPARRA v4 is fitted. Hence, v4(X i ) is an estimator of Pr(EA|X i , v3(X i )), a 'conditional' risk after interventions driven by v3(X i ) have been implemented. If v4 naively replaced v3 ( Figure 6C ), we would be using v4 to predict behaviour of a system different to that on which it was trained ( Figure 6B ). To amend this problem, we propose to use v4 in conjunction with v3 rather than to replace it ( Figure 6D ). Ideally, GPs would be given v3(X i ) and v4(X i ) simultaneously and asked to firstly observe and act on v3(X i ), then observe and act on v4(X i ), thereby only using v4(X i ) as per Figure 6D . This is impractical, so instead, we disseminate to GPs the single value max(v3, v4), avoiding the potential hazard of risk underestimation, at the cost of loss of score calibration.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 365,
                    "end": 373,
                    "text": "Figure 6",
                    "ref_id": "FIGREF17"
                },
                {
                    "start": 467,
                    "end": 476,
                    "text": "Figure 6A",
                    "ref_id": "FIGREF17"
                },
                {
                    "start": 898,
                    "end": 907,
                    "text": "Figure 6B",
                    "ref_id": "FIGREF17"
                },
                {
                    "start": 1214,
                    "end": 1223,
                    "text": "Figure 6C",
                    "ref_id": "FIGREF17"
                },
                {
                    "start": 1325,
                    "end": 1334,
                    "text": "Figure 6B",
                    "ref_id": "FIGREF17"
                },
                {
                    "start": 1433,
                    "end": 1442,
                    "text": "Figure 6D",
                    "ref_id": "FIGREF17"
                },
                {
                    "start": 1630,
                    "end": 1639,
                    "text": "Figure 6D",
                    "ref_id": "FIGREF17"
                }
            ],
            "section": "Model updating"
        },
        {
            "text": "Raw data for this project are patient-level NHS Scotland health records, and are confidential. Due to the confidential nature of the data used, all analysis took place on remote 'safe havens' [2, 4] , without access to internet, software updates or unpublished software. Information Governance training was required for all researchers accessing the analysis environment. Moreover, to avoid the risk of accidental disclosure of sensitive information, an independent team carried out statistical disclosure control checks to all data exports, including the outputs presented in this manuscript. All analysis code and co-ordinates required to reproduce our Figures are available in github.com/jamesliley/SPARRAv4.",
            "cite_spans": [
                {
                    "start": 192,
                    "end": 195,
                    "text": "[2,",
                    "ref_id": null
                },
                {
                    "start": 196,
                    "end": 198,
                    "text": "4]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Code and data availability and reproducibility."
        },
        {
            "text": "This work was conducted in accordance with UK data governance regulations under PBPP application number eDRIS 1718-0370 12 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ETHICS STATEMENT"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ETHICS STATEMENT"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint Figure 6 . Causal structure for fitting of SPARRA v3 and v4. X i represents covariates for a patient-time pair; Y represents the EA event; v3( f it)/v4( f it) and v3(X i )/v3(X i ) represent the fitting and deployment of v3 and v4 respectively. Note v3 and v4 are fitted to different systems, so v4 cannot be used to directly replace v3.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 144,
                    "end": 152,
                    "text": "Figure 6",
                    "ref_id": "FIGREF17"
                }
            ],
            "section": "ETHICS STATEMENT"
        },
        {
            "text": "[24] World Health Organization. International statistical classification of diseases and related health problems. [28] Adarsh Subbaswamy and Suchi Saria. \"From development to deployment: dataset shift, causality, and shift-stable models in health AI\". In: Biostatistics 21.2 (2020), pp. 345-352.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ETHICS STATEMENT"
        },
        {
            "text": "[29] Mark J Van der Laan, Eric C Polley, and Alan E Hubbard. \"Super learner\". In: Statistical applications in genetics and molecular biology 6.1 (2007).",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ETHICS STATEMENT"
        },
        {
            "text": "[30] Emma Wallace et al. \"Risk prediction models to predict emergency hospital admission in community-dwelling adults: a systematic review\". In: Medical care 52.8 (2014), p. 751.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ETHICS STATEMENT"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "15"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. Table 3 : Areas under ROC/PRC curves for each constituent model by cross-validation fold 4. Table 4 : Exploration of contributors to each topic. 5. Figure 29. TRIPOD: Checklist for TRIPOD guidelines [11] , and associated pages. S1 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [
                {
                    "start": 335,
                    "end": 339,
                    "text": "[11]",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 136,
                    "end": 143,
                    "text": "Table 3",
                    "ref_id": "TABREF11"
                },
                {
                    "start": 228,
                    "end": 235,
                    "text": "Table 4",
                    "ref_id": null
                },
                {
                    "start": 284,
                    "end": 290,
                    "text": "Figure",
                    "ref_id": null
                }
            ],
            "section": "15"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "15"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint",
            "cite_spans": [],
            "ref_spans": [],
            "section": "15"
        },
        {
            "text": "Reference Description Notes SMR00 [4] Outpatient attendance SMR01 [5] Acute hospital admissions Non-psychiatric, non-obstetric SMR01E [6] Geriatric long stay SMR04 [5] Psychiatric hospital admissions Acute only AE2 [1] Accident and emergency records PIS [3] Prescribing information SystemWatch [7] Urgent care monitoring LTC [2] Long-term conditions Table 1 . Data sources used to derive SPARRA v4 predictors. SMR -Scottish Morbidity Records. Also see Figure 1b S2 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [
                {
                    "start": 34,
                    "end": 37,
                    "text": "[4]",
                    "ref_id": null
                },
                {
                    "start": 66,
                    "end": 69,
                    "text": "[5]",
                    "ref_id": null
                },
                {
                    "start": 134,
                    "end": 137,
                    "text": "[6]",
                    "ref_id": null
                },
                {
                    "start": 164,
                    "end": 167,
                    "text": "[5]",
                    "ref_id": null
                },
                {
                    "start": 215,
                    "end": 218,
                    "text": "[1]",
                    "ref_id": "BIBREF0"
                },
                {
                    "start": 254,
                    "end": 257,
                    "text": "[3]",
                    "ref_id": null
                },
                {
                    "start": 294,
                    "end": 297,
                    "text": "[7]",
                    "ref_id": null
                },
                {
                    "start": 325,
                    "end": 328,
                    "text": "[2]",
                    "ref_id": null
                }
            ],
            "ref_spans": [
                {
                    "start": 350,
                    "end": 357,
                    "text": "Table 1",
                    "ref_id": null
                },
                {
                    "start": 452,
                    "end": 461,
                    "text": "Figure 1b",
                    "ref_id": null
                }
            ],
            "section": "Name"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Name"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S7"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. Table 4 . Details of derived topics for topic model used for prediction in fold 1 (fitted to folds 2 and 3). A topic model assumes that each 'document' (individual) in a 'corpus' (population) is associated with various 'topics' (roughly, illness categories) where each topic corresponds to a distribution over 'words' (ICD10 codes and medication types). We would expect that the 30 topics fitted to each fold roughly represent the major clusters of disease types which occur amongst those individuals. This tables shows the 'words' with the highest probability of membership in each topic (> 1%, where probabilities over all words sum to 100%). In each topic, words are ordered by decreasing probability of topic membership. ICD10 codes are italicised; medication types are not. Topics are ordered by decreasing importance (mean absolute Shapley value). We assign labels to some topics which appear to code for clear disease types, italicised for tenuous links. S11 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 544,
                    "end": 551,
                    "text": "Table 4",
                    "ref_id": null
                }
            ],
            "section": "S7"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S7"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. Pr % % / \u2aeb % | % \"$ 6 \u2aeb % , % Figure 1 . Variable dependencies. Boxes denote random variables, arrows denote causal dependence. In general, X \u00b7 are predictors, Y \u00b7 are targets, T \u00b7 is a topic model, \u03b2 \u00b7 are parameters, and \u03bb \u00b7 are hyperparameters. See online methods for details.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 106,
                    "end": 114,
                    "text": "Figure 1",
                    "ref_id": null
                }
            ],
            "section": "S7"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S12"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S12"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S12"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S13"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S13"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S13"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S13"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S15"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S15"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S15"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S16"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S16"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S16"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. . Joint density (low to high: white-grey-red-yellow) of individual risk scores at t i and t j for (i, j) \u2208 {1, 2, 3, 4, 5}, i < j. The density is normalised to uniform marginals; true marginal distributions of risk scores are shown alongside in grey. S18 All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S16"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S16"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S16"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. Figure 10 . SPARRA v4 performance by category of admission type. Bar height for a given particular x-axis category and a given colour indicates the number of individuals with that x-axis category as a proportion of the cohort of individuals reaching the SPARRA v4 threshold indicated by the colour; note that percentages sum to 100 across bars of each colour, not each category. For a given x-axis category, a rising profile for greyer colours indicates relatively better prediction of this category and a dropping profile indicates worse prediction.",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 76,
                    "end": 85,
                    "text": "Figure 10",
                    "ref_id": null
                }
            ],
            "section": "S16"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S20"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S20"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. Figure 11 . SPARRA v4 performance by type of admission; data as per figure 3d. Bar height for a given particular x-axis category and a given colour indicates the positive predictive value for predicting an admission of that type given a score \u2265 the associated value. Note that, particularly for low scores, the positive predictive value for being admitted at all is low. ",
            "cite_spans": [],
            "ref_spans": [
                {
                    "start": 76,
                    "end": 85,
                    "text": "Figure 11",
                    "ref_id": null
                }
            ],
            "section": "S20"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S21"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S21"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S21"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint SUPPLEMENTARY NOTE",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S22"
        },
        {
            "text": "We used a range of constituent models, detailed below. In all cases, hyperparameters were determined by randomly splitting the relevant dataset into a training and test set of 80% and 20% of the data respectively.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "MODEL DETAILS"
        },
        {
            "text": "We used SPARRA v3 as one constituent model.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Existing model"
        },
        {
            "text": "We used an artificial neural network as implemented in the h2o platform (via the h2o R package [13] ). We optimised over the number of layers (1 or 2) and the number of nodes in each layer (128 or 256). We used a training dropout rate of 20% to reduce generalisation error.",
            "cite_spans": [
                {
                    "start": 95,
                    "end": 99,
                    "text": "[13]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Artificial neural network"
        },
        {
            "text": "We fitted two random forests using the h2o R package [13] . One had maximum depth 20 and 500 trees, and the other had maximum depth 40 and 50 trees (both taking a similar time to fit). Settings were otherwise left as h2o defaults (see [13] ).",
            "cite_spans": [
                {
                    "start": 53,
                    "end": 57,
                    "text": "[13]",
                    "ref_id": null
                },
                {
                    "start": 235,
                    "end": 239,
                    "text": "[13]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Random forest"
        },
        {
            "text": "We used the R package xgboost [10] to fit three boosted tree models, considering the number of trees as a hyperparameter. We considered trees at three maximum depths: 3, 4, and 8. For the deeper-tree model, we set a low step size shrinkage (\u03b7) of 0.075 and a positive minimum loss reduction (\u03b3) of 5 in order to avoid overfitting. In the other two models, we used default values of \u03b7=0.3, \u03b3 = 0.",
            "cite_spans": [
                {
                    "start": 30,
                    "end": 34,
                    "text": "[10]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Boosted trees"
        },
        {
            "text": "We used the h2o package [13] to fit naive Bayes models. The only hyperparameter we considered was a Laplace smoothing parameter, varying between 0 and 4.",
            "cite_spans": [
                {
                    "start": 24,
                    "end": 28,
                    "text": "[13]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Naive Bayes"
        },
        {
            "text": "We used the h2o package [13] to fit generalised linear models. We optimised L 1 and L 2 penalties (an elastic net), considering total penalty (L 1 + L 2 ) in 10 \u2212{1,2,3,4,5} , and a ratio L 1 /L 2 in {0, 0.5, 1}.",
            "cite_spans": [
                {
                    "start": 24,
                    "end": 28,
                    "text": "[13]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Generalised linear model"
        },
        {
            "text": "We aggregated models by finding the linear combination which optimised AUROC in a separate training sample. We included an L 1 penalty as a hyperparameter in this step [12] .",
            "cite_spans": [
                {
                    "start": 168,
                    "end": 172,
                    "text": "[12]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "Super-learner"
        },
        {
            "text": "A problem in choice or target arises due to death of individuals during the follow-up year. Broadly, there are four options for how to treat such individuals:",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DEATH IN FOLLOW-UP PERIOD"
        },
        {
            "text": "1. Exclude them from the dataset 2. Classify them as according to whether they had an emergency admission before they died 3. Classify them as no admission, or",
            "cite_spans": [],
            "ref_spans": [],
            "section": "DEATH IN FOLLOW-UP PERIOD"
        },
        {
            "text": "The philosophy of the SPARRA score is to avert breakdowns in health, of which death can be considered an example. Option 3 would effectively classify death as a 'desirable' outcome, so we avoided it. Option 2 would effectively mean such individuals have a follow-up time less than a year, and would classify individuals who died without a hospital admission as having had a 'desirable' outcome. Option 1 would exclude the most critically ill individuals from the dataset. Our choice of option 4 allows the general description of the target as 'a catastrophic breakdown in health'.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Classify them as an admission"
        },
        {
            "text": "It would also be possible to code death in follow-up differentially; for instance, coding in-hospital death as EA and in-community death as exclusions or non-EA. Our choice not to code all deaths identically is in the interests of non-maleficence. If an individual is at risk of imminent death in the community they will typically be admitted to hospital if it is possible to react in time, with a possible exemption if this is not in their best interests.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "Classify them as an admission"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S30"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S30"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S30"
        },
        {
            "text": "The error in SPARRA scores from coding all deaths as EA is thus in assigning high scores to the very old and terminally ill, when in fact these individuals may be treated in the community rather than admitted. The potential harm from this option is small: it could mean that such individuals are excessively treated rather than palliated, but since palliation over treatment is an active decision [14] and such individuals are generally known to be high-risk it is unlikely that the SPARRA score will adversely affect any decisions in this case.",
            "cite_spans": [
                {
                    "start": 397,
                    "end": 401,
                    "text": "[14]",
                    "ref_id": "BIBREF13"
                }
            ],
            "ref_spans": [],
            "section": "S30"
        },
        {
            "text": "However, the error from coding community deaths as non-EA would be more severe, as it could mean that healthier individuals at risk of sudden death are either coded as non-EA or excluded from the dataset, potentially leading to inappropriately low scores being assigned to these individuals. This could draw treatment away from individuals in high need.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S30"
        },
        {
            "text": "Denote by For prediction on fold 3, we began by fitting a Latent Dirichlet Allocation-based topic model T 12 to predictor data (X 1 , X 2 ), retaining 30 topic features to be used as predictors. See [8] for details. For each constituent model F i we partitioned X 1 , Y 1 into train/test sets in size ratio 4 : 1 and determined fold-specific parameters {\u03b2 1 } i and hyperparameters {\u03bb 1 } i in the usual way according to",
            "cite_spans": [
                {
                    "start": 199,
                    "end": 202,
                    "text": "[8]",
                    "ref_id": null
                }
            ],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "We then evaluated each model on X 2 and established an optimal L-1 penalised linear sum with parameters \u03b2 e 12 and hyperparameter \u03bb e 12 (e for 'ensemble'), after splitting into cross-validation folds:",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "where bars indicate mean over each cross-validation permuation of train/test sets. Given the output of the ensemble\u1ef8 2 (X 2 ) = \u03b2 e \u00b7\u0176 2 (taken as a function of X 2 ), we then computed a transform m e 12 (x) to optimise calibration, essentially using isotonic regression. We defined an empirical calibration function for an estimator Y (X) of Y |X:",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "We first found a, b such that the mean and mode of (a\u1ef8 2 + b) were approximately correctly calibrated; that is, CAL a\u1ef8 2 +b (x) = x for x \u2208 {mean(a\u1ef8 2 + b), mode(a\u1ef8 2 + b)}, and scaled a, b such that 0 \u2264 a\u1ef8 2 (X 2 ) + b \u2264 1. Across an evenly spaced grid G of 100",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "x-values we computed the function:",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "c(x) = (1 \u2212 10 \u22125 ) max x \u2208G;x \u2264x CAL a\u1ef8 2 +b (x ) + 10 \u22125 x (3)",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "using the cumulative maximum of CAL(x) to ensure c is non-decreasing, and adding a linear term to ensure c is increasing. We extended the domain of c to [0, 1] using piecewise linear interpolation, and defined our calibrating transform m e 12 as the inverse of c:",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "Finally, we re-determined parameters and hyperparameters on folds 1 and 2 (denoting X 12 = (X 1 , X 2 ), Y 12 = (Y 1 ,Y 2 ) \u03b2 max (\u03bb ) arg min \u03b2 \u2208B i L i F i X train 12 , T 12 (X train 12 ); \u03b2 , \u03bb ,Y train ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "Considered as a function of X, this function depends only on parameters determined using X 12 , Y 12 , and hence is independent of X 3 and Y 3 and conditionally independent of Y 3 given X 3 .",
            "cite_spans": [],
            "ref_spans": [],
            "section": "CROSS-VALIDATION PROCEDURE"
        },
        {
            "text": "Data study groups (DSGs) are week long collaborative efforts held in the Alan Turing Institute, where teams of students, early career researchers in data science combine to tackle the real-world problems of non-academic partners. In 2017, one such event was organised with the task of exploring the scope of improving SPARRA performance using modern approaches in machine learning. Despite the time restrictions of this project, results were promising, suggesting advanced machine learning techniques such as random forests offered improved performance over traditional approaches such as logistic regression, as used in the SPARRA v3 model. This project arose from a collaboration between Public Health Scotland, the Scottish National Health Service, and the Alan Turing Institute, a UK government-founded artificial intelligence research organisation. Collaboration between groups was largely electronic, but face-to-face knowledge transfer meetings were essential in facilitating knowledge transfer between groups.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "PRACTICALITIES"
        },
        {
            "text": "We assume in general that, for IID predictor/outcome pairs (X i ,Y i ) \u223c (X,Y ), i \u2208 1..n, and an optimal predictor function p opt , we have",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ASSESSMENT OF CALIBRATION"
        },
        {
            "text": "noting that this implies p opt (X) = E[Y |p opt (X)]",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ASSESSMENT OF CALIBRATION"
        },
        {
            "text": "We want to estimate p opt (X).",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ASSESSMENT OF CALIBRATION"
        },
        {
            "text": "All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S32"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S32"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "S32"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. 13 TRIPOD guidelines and pages where discussed All rights reserved. No reuse allowed without permission.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "TRIPOD GUIDELINES"
        },
        {
            "text": "(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "TRIPOD GUIDELINES"
        },
        {
            "text": "The copyright holder for this preprint this version posted August 10, 2021. ; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint",
            "cite_spans": [],
            "ref_spans": [],
            "section": "TRIPOD GUIDELINES"
        }
    ],
    "bib_entries": {
        "BIBREF0": {
            "ref_id": "b0",
            "title": "A Report on the Development of SPARRA Version 3 (Developing Risk Prediction to Support Preventative and Anticipatory Care in Scotland",
            "authors": [],
            "year": 2011,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "6--9",
            "other_ids": {}
        },
        "BIBREF2": {
            "ref_id": "b2",
            "title": "The National framework for service change in NHS Scotland",
            "authors": [],
            "year": 2005,
            "venue": "Scottish Executive",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF3": {
            "ref_id": "b3",
            "title": "Design choices for productive, secure, data-intensive research at scale in the cloud",
            "authors": [
                {
                    "first": "Diego",
                    "middle": [],
                    "last": "Arenas",
                    "suffix": ""
                }
            ],
            "year": 2019,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {
                "arXiv": [
                    "arXiv:1908.08737"
                ]
            }
        },
        "BIBREF4": {
            "ref_id": "b4",
            "title": "Latent Dirichlet allocation",
            "authors": [
                {
                    "first": "M",
                    "middle": [],
                    "last": "David",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Blei",
                    "suffix": ""
                },
                {
                    "first": "Y",
                    "middle": [],
                    "last": "Andrew",
                    "suffix": ""
                },
                {
                    "first": "Michael I Jordan",
                    "middle": [],
                    "last": "Ng",
                    "suffix": ""
                }
            ],
            "year": 2003,
            "venue": "Journal of machine Learning research",
            "volume": "3",
            "issn": "",
            "pages": "993--1022",
            "other_ids": {}
        },
        "BIBREF5": {
            "ref_id": "b5",
            "title": "Focus on preventable admissions",
            "authors": [
                {
                    "first": "Ian",
                    "middle": [],
                    "last": "Blunt",
                    "suffix": ""
                }
            ],
            "year": 2013,
            "venue": "London: Nuffield Trust",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF6": {
            "ref_id": "b6",
            "title": "Identifying patients at high risk of emergency hospital admissions: a logistic regression analysis",
            "authors": [
                {
                    "first": "Alex",
                    "middle": [],
                    "last": "Bottle",
                    "suffix": ""
                },
                {
                    "first": "Paul",
                    "middle": [],
                    "last": "Aylin",
                    "suffix": ""
                },
                {
                    "first": "Azeem",
                    "middle": [],
                    "last": "Majeed",
                    "suffix": ""
                }
            ],
            "year": 2006,
            "venue": "Journal of the Royal Society of Medicine",
            "volume": "99",
            "issn": "",
            "pages": "406--414",
            "other_ids": {}
        },
        "BIBREF7": {
            "ref_id": "b7",
            "title": "Extreme Gradient Boosting",
            "authors": [
                {
                    "first": "Tianqi",
                    "middle": [],
                    "last": "Chen",
                    "suffix": ""
                }
            ],
            "year": null,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF8": {
            "ref_id": "b8",
            "title": "Alternatives to hospital care: what are they and who should decide?",
            "authors": [
                {
                    "first": "Joanna",
                    "middle": [],
                    "last": "Coast",
                    "suffix": ""
                },
                {
                    "first": "Abby",
                    "middle": [],
                    "last": "Inglis",
                    "suffix": ""
                },
                {
                    "first": "Stephen",
                    "middle": [],
                    "last": "Frankel",
                    "suffix": ""
                }
            ],
            "year": 1996,
            "venue": "In: Bmj",
            "volume": "312",
            "issn": "",
            "pages": "162--166",
            "other_ids": {}
        },
        "BIBREF9": {
            "ref_id": "b9",
            "title": "Transparent Reporting of a Multivariable Prediction Model for Individual Prognosis or Diagnosis (TRIPOD) The TRIPOD Statement",
            "authors": [
                {
                    "first": "S",
                    "middle": [],
                    "last": "Gary",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Collins",
                    "suffix": ""
                }
            ],
            "year": 2015,
            "venue": "Circulation 131",
            "volume": "2",
            "issn": "",
            "pages": "211--219",
            "other_ids": {}
        },
        "BIBREF10": {
            "ref_id": "b10",
            "title": "Comparing the areas under two or more correlated receiver operating characteristic curves: a nonparametric approach",
            "authors": [
                {
                    "first": "R",
                    "middle": [],
                    "last": "Elizabeth",
                    "suffix": ""
                },
                {
                    "first": "David",
                    "middle": [
                        "M"
                    ],
                    "last": "Delong",
                    "suffix": ""
                },
                {
                    "first": "Daniel L Clarke-Pearson",
                    "middle": [],
                    "last": "Delong",
                    "suffix": ""
                }
            ],
            "year": 1988,
            "venue": "Biometrics",
            "volume": "",
            "issn": "",
            "pages": "837--845",
            "other_ids": {}
        },
        "BIBREF11": {
            "ref_id": "b11",
            "title": "Demographic and practice factors predicting repeated non-attendance in primary care: a national retrospective cohort analysis",
            "authors": [
                {
                    "first": "A",
                    "middle": [],
                    "last": "David",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Ellis",
                    "suffix": ""
                }
            ],
            "year": 2017,
            "venue": "The Lancet Public Health",
            "volume": "2",
            "issn": "",
            "pages": "551--559",
            "other_ids": {}
        },
        "BIBREF12": {
            "ref_id": "b12",
            "title": "Scottish index of multiple deprivation 2006 technical report",
            "authors": [
                {
                    "first": "Scottish",
                    "middle": [],
                    "last": "Executive",
                    "suffix": ""
                }
            ],
            "year": 2006,
            "venue": "Office of the Chief Statistician, Scottish Executive",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF13": {
            "ref_id": "b13",
            "title": "Apples-to-apples in cross-validation studies: pitfalls in classifier performance measurement",
            "authors": [
                {
                    "first": "George",
                    "middle": [],
                    "last": "Forman",
                    "suffix": ""
                },
                {
                    "first": "Martin",
                    "middle": [],
                    "last": "Scholz",
                    "suffix": ""
                }
            ],
            "year": 2010,
            "venue": "Acm Sigkdd Explorations Newsletter",
            "volume": "12",
            "issn": "",
            "pages": "49--57",
            "other_ids": {}
        },
        "BIBREF14": {
            "ref_id": "b14",
            "title": "Scottish index of multiple deprivation",
            "authors": [
                {
                    "first": "Scottish",
                    "middle": [],
                    "last": "Government",
                    "suffix": ""
                }
            ],
            "year": 2016,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF15": {
            "ref_id": "b15",
            "title": "Risk prediction models for hospital readmission: a systematic review",
            "authors": [
                {
                    "first": "Devan",
                    "middle": [],
                    "last": "Kansagara",
                    "suffix": ""
                }
            ],
            "year": 2011,
            "venue": "Jama",
            "volume": "306",
            "issn": "",
            "pages": "1688--1698",
            "other_ids": {}
        },
        "BIBREF17": {
            "ref_id": "b17",
            "title": "Prognostic models will be victims of their own success, unless",
            "authors": [
                {
                    "first": "C",
                    "middle": [],
                    "last": "Matthew",
                    "suffix": ""
                },
                {
                    "first": "Michael",
                    "middle": [
                        "E"
                    ],
                    "last": "Lenert",
                    "suffix": ""
                },
                {
                    "first": "Colin",
                    "middle": [
                        "G"
                    ],
                    "last": "Matheny",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Walsh",
                    "suffix": ""
                }
            ],
            "year": 2019,
            "venue": "Journal of the American Medical Informatics Association",
            "volume": "26",
            "issn": "",
            "pages": "1645--1650",
            "other_ids": {}
        },
        "BIBREF18": {
            "ref_id": "b18",
            "title": "Model updating after interventions paradoxically introduces bias",
            "authors": [
                {
                    "first": "James",
                    "middle": [],
                    "last": "Liley",
                    "suffix": ""
                }
            ],
            "year": 2021,
            "venue": "AISTATS proceedings",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF19": {
            "ref_id": "b19",
            "title": "A unified approach to interpreting model predictions",
            "authors": [
                {
                    "first": "M",
                    "middle": [],
                    "last": "Scott",
                    "suffix": ""
                },
                {
                    "first": "Su-In",
                    "middle": [],
                    "last": "Lundberg",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Lee",
                    "suffix": ""
                }
            ],
            "year": 2017,
            "venue": "Advances in neural information processing systems",
            "volume": "",
            "issn": "",
            "pages": "4765--4774",
            "other_ids": {}
        },
        "BIBREF20": {
            "ref_id": "b20",
            "title": "Predicting the likelihood of emergency admission to hospital of older people: development and validation of the Emergency Admission Risk Likelihood Index (EARLI)",
            "authors": [
                {
                    "first": "David",
                    "middle": [],
                    "last": "Lyon",
                    "suffix": ""
                }
            ],
            "year": 2007,
            "venue": "Family practice",
            "volume": "24",
            "issn": "",
            "pages": "158--167",
            "other_ids": {}
        },
        "BIBREF21": {
            "ref_id": "b21",
            "title": "Measuring appropriate use of acute beds: a systematic review of methods and results",
            "authors": [
                {
                    "first": "S",
                    "middle": [],
                    "last": "Marian",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Mcdonagh",
                    "suffix": ""
                },
                {
                    "first": "H",
                    "middle": [],
                    "last": "David",
                    "suffix": ""
                },
                {
                    "first": "Maria",
                    "middle": [],
                    "last": "Smith",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Goddard",
                    "suffix": ""
                }
            ],
            "year": 2000,
            "venue": "Health policy",
            "volume": "53",
            "issn": "",
            "pages": "157--184",
            "other_ids": {}
        },
        "BIBREF22": {
            "ref_id": "b22",
            "title": "Census aggregate data",
            "authors": [],
            "year": 2011,
            "venue": "UK Data Service",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {
                "DOI": [
                    "10.5257/census/aggregate-2011-1"
                ]
            }
        },
        "BIBREF23": {
            "ref_id": "b23",
            "title": "Since we only observe Y = 1 or Y = 0, we must estimate E[Y |p(X) = z] as some kind of average of Y about observed values p(X) close to z. A routine way to do this is to use 'reliability diagrams' [9] in which we bin values of p(X) and estimate E(Y |p(X)) in each bin. Since for small bin sizes there may be few or no values of p(X) in some bins, we use a kernel estimate\u0109 p (z) of REFERENCES [1",
            "authors": [],
            "year": 2020,
            "venue": "Public health information Scotland",
            "volume": "",
            "issn": "",
            "pages": "6--9",
            "other_ids": {}
        },
        "BIBREF24": {
            "ref_id": "b24",
            "title": "Public health information Scotland",
            "authors": [],
            "year": 2020,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF25": {
            "ref_id": "b25",
            "title": "PIS -prescribing information systems",
            "authors": [],
            "year": 2020,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "6--9",
            "other_ids": {}
        },
        "BIBREF26": {
            "ref_id": "b26",
            "title": "Public health information Scotland",
            "authors": [],
            "year": 2020,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF27": {
            "ref_id": "b27",
            "title": "Public health information Scotland",
            "authors": [],
            "year": 2020,
            "venue": "SMR01 -Acute Hospital Admissions",
            "volume": "",
            "issn": "",
            "pages": "6--9",
            "other_ids": {}
        },
        "BIBREF28": {
            "ref_id": "b28",
            "title": "SMR01 -Acute Hospital Admissions; SMR04 -Psychiatric Hospital Admissions",
            "authors": [],
            "year": 2020,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "6--9",
            "other_ids": {}
        },
        "BIBREF29": {
            "ref_id": "b29",
            "title": "Public health information Scotland",
            "authors": [],
            "year": 2020,
            "venue": "System Watch: urgent care usage",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF30": {
            "ref_id": "b30",
            "title": "Latent Dirichlet allocation",
            "authors": [
                {
                    "first": "M",
                    "middle": [],
                    "last": "David",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Blei",
                    "suffix": ""
                },
                {
                    "first": "Y",
                    "middle": [],
                    "last": "Andrew",
                    "suffix": ""
                },
                {
                    "first": "Michael I Jordan",
                    "middle": [],
                    "last": "Ng",
                    "suffix": ""
                }
            ],
            "year": 2003,
            "venue": "Journal of machine Learning research",
            "volume": "3",
            "issn": "",
            "pages": "993--1022",
            "other_ids": {}
        },
        "BIBREF31": {
            "ref_id": "b31",
            "title": "Increasing the reliability of reliability diagrams",
            "authors": [
                {
                    "first": "Jochen",
                    "middle": [],
                    "last": "Br\u00f6cker",
                    "suffix": ""
                },
                {
                    "first": "A",
                    "middle": [],
                    "last": "Leonard",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Smith",
                    "suffix": ""
                }
            ],
            "year": 2007,
            "venue": "Weather and forecasting",
            "volume": "22",
            "issn": "",
            "pages": "651--661",
            "other_ids": {}
        },
        "BIBREF32": {
            "ref_id": "b32",
            "title": "Extreme Gradient Boosting",
            "authors": [
                {
                    "first": "Tianqi",
                    "middle": [],
                    "last": "Chen",
                    "suffix": ""
                }
            ],
            "year": null,
            "venue": "",
            "volume": "",
            "issn": "",
            "pages": "",
            "other_ids": {}
        },
        "BIBREF33": {
            "ref_id": "b33",
            "title": "Transparent Reporting of a Multivariable Prediction Model for Individual Prognosis or Diagnosis (TRIPOD) The TRIPOD Statement",
            "authors": [
                {
                    "first": "S",
                    "middle": [],
                    "last": "Gary",
                    "suffix": ""
                },
                {
                    "first": "",
                    "middle": [],
                    "last": "Collins",
                    "suffix": ""
                }
            ],
            "year": 2015,
            "venue": "Circulation 131",
            "volume": "2",
            "issn": "",
            "pages": "211--219",
            "other_ids": {}
        },
        "BIBREF34": {
            "ref_id": "b34",
            "title": "Regularization paths for generalized linear models via coordinate descent",
            "authors": [
                {
                    "first": "Jerome",
                    "middle": [],
                    "last": "Friedman",
                    "suffix": ""
                },
                {
                    "first": "Trevor",
                    "middle": [],
                    "last": "Hastie",
                    "suffix": ""
                },
                {
                    "first": "Rob",
                    "middle": [],
                    "last": "Tibshirani",
                    "suffix": ""
                }
            ],
            "year": 2010,
            "venue": "Journal of statistical software",
            "volume": "33",
            "issn": "",
            "pages": "",
            "other_ids": {}
        }
    },
    "ref_entries": {
        "FIGREF1": {
            "text": "Figure 2. Comparison of SPARRA v3 and v4. Panels 2a, 2b, 2c show ROC, PRC and calibration curve respectively for SPARRA v4 (new score), SPARRA v3 (existing score), and max v3, v4 (deployed score). Lower sub-panels show difference between v4/max(v3, v4) and v3 in panels 2a and 2b, and difference between curves and the X-Y line in panel 2c. Confidence intervals in panels 2a and 2b are negligible; confidence envelopes in panel 2c are pointwise (that is, for each x-value, not the whole curve). Predicted/true value pairs are combined across cross-validation folds in all plots for simplicity. Panel 2d shows the difference in the number of individuals who had an EA amongst individuals designated highest-risk by v3 and v4. Lines indicate deviation from perfect calibration. The repeating pattern is due to rounding of v3. Panel 2e shows the difference in the number of highest-risk individuals to target to avoid a given number of admissions. Panels 2f,2g and 2h compare ROC curves of SPARRA v4 (new model) and SPARRA v3 (existing model) in patient subcohorts defined by different risk levels. Comparisons of performance over other subcohorts are shown in Supplementary Figures 9. Panel 2i shows calibration curves for v3 and v4 in samples for which |v3 \u2212 v4| > 0.1.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF2": {
            "text": "Figure 3. Stratified performance of SPARRA v3 and v4. Panels 3a, 3b and 3c show difference in AUROC between v3 and v4 (red/black) and EA frequency (dashed lines) in subcohorts defined by age, SIMD and the original subcohorts defined during SPARRA v3 development (see Introduction), respectively. Panels 3d and 3e show SPARRA v4 performance by category of disease by ICD10 code (Abnormality NEC: abnormality not elsewhere classified; ). In panel 3d, bar height for a given particular x-axis category and a given colour (score threshold) is the proportion of individuals with EA reaching that score threshold admitted for that reason. Percentages sum to 100% across bars of each colour (score category) rather than disease category. A rising profile indicates relatively better prediction of this category. Panel 3e shows distribution of log-scores for individuals admitted in each class, with black points indicating the associated medians. Supplementary figure 11 shows equivalent data to panel 3d as positive-predictive values. Panel 3f shows the distribution of time-to-event after the first time cutoff amongst cohorts of individuals who 1) had an EA in the year following the time cutoff and 2) had a SPARRA v4 score above a given cutoff. Panel 3g shows the discrete distribution of number of events over the same cohorts. Panel 3h shows the distribution of time-to-event amongst cohorts of individuals who were admitted exactly once in the year following the first time cutoff.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF3": {
            "text": "Bivariate density of scores 6 months apart",
            "latex": null,
            "type": "figure"
        },
        "FIGREF4": {
            "text": "Behaviour of the same predictions over time. Panels 4a, 4b, 4c",
            "latex": null,
            "type": "figure"
        },
        "FIGREF7": {
            "text": "ROC curves for constituents of SPARRA model 7.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF8": {
            "text": "PR curves for constituents of SPARRA model 8.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF9": {
            "text": "Calibration curves for constituents of SPARRA model 9. Figure 5: Density plot showing SPARRA v3 against SPARRA v4. 10. Figure 6: Non-attenuation of model performance with time: ROC, PRC and calibration 11. Figure 8: Attenuation of out-of-date risk scores at predicting EA in subsequent years. 12. Figure 7: Bivariate densities of SPARRA scores computed for the same individuals at different time points 13. Figure 9: Performance of SPARRA v3 and v4 restricting to first and final time points 14. Figure 10: Distribution of individuals at a given SPARRA score cutoff across admission types 15. Figure 11: PPVs for predicting each cause of admission given SPARRA score cutoff 16. Figure 12: ROC, PRC and calibration curves comparing models fitted with and without topic features 17. Figure 13: Shapley values vs value for number of emergency and elective admissions. 18. Figure 14: Shapley value vs value for predictors 1-9 19. Figure 15: Shapley value vs value for predictors 10-18 20. Figure 16: Shapley value vs value for predictors 19-27 21. Figure 17: Shapley value vs value for predictors 28-36 22. Figure 18: Shapley value vs value for predictors 37-45 23. Figure 19: Shapley value vs value for predictors 46-54 24. Figure 20: Shapley value vs value for predictors 55",
            "latex": null,
            "type": "figure"
        },
        "FIGREF12": {
            "text": "Receiver-operator characteristic curves showing discriminative ability of constituent models of SPARRA v4.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF13": {
            "text": "Precision recall curves showing discriminative ability of constituent models of SPARRA v4. S14 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF14": {
            "text": "Calibration curves showing discriminative ability of constituent models of SPARRA v4. Confidence envelopes are pointwise.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF16": {
            "text": "Joint density (low to high: white-grey-red-yellow) of individual SPARRA v3 and v4 scores. The density is normalised to uniform marginal on the Y axis, then the X axis; true marginal distributions of risk scores are shown alongside in grey.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF17": {
            "text": "ROC curves, PR curves and calibration curves for a model M 0 fitted to an early time point (2 May 2014) and evaluated at later time points. S17 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF18": {
            "text": "Figure 7. Joint density (low to high: white-grey-red-yellow) of individual risk scores at t i and t j for (i, j) \u2208 {1, 2, 3, 4, 5}, i < j. The density is normalised to uniform marginals; true marginal distributions of risk scores are shown alongside in grey.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF19": {
            "text": "AUROCs for predictions calculated at each time point for prediction EA in years following subsequent time points. Performance of SPARRA v4 (new model) and SPARRA v3 (existing model) in subcohorts: final time point only and first time point only. Plots show ROC curves. S19 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF20": {
            "text": "Comparison of model performance with and without topic-model derived features. Models with topic features perform slightly better by AUROC and AUPRC, and are equivocally well-calibrated.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF21": {
            "text": "Influence of number of previous elective (Elec.) and emergency (Em.) admissions on risk scores. Also see supplementary table 2 and Supplementary Figures 14-20.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF22": {
            "text": "Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous S23 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF23": {
            "text": "Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous S24 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF24": {
            "text": "Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous S25 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF25": {
            "text": "Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous S26 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF26": {
            "text": "Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous S27 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF27": {
            "text": "Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous S28 All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "figure"
        },
        "FIGREF28": {
            "text": "X f ,Y f the data (predictors, outcome) in fold f ,X the domain of X,T \u00b7 a topic model interpreted as a function T \u00b7 : X \u2192 [0, 1] 30 ,F i (\u00b7; \u03b2 , \u03bb ) the ith constituent model (i \u2208 {1 . . .9} with parameters \u03b2 i and hyperparameters \u03bb i ; F i : (X \u00d7 T \u00b7 (X)) \u2192 [0, 1]), B i and L i the spaces of parameters and hyperparameters for F i , L i : ([0, 1] \u00d7 {0, 1}) \u2192 R the loss function for F i",
            "latex": null,
            "type": "figure"
        },
        "FIGREF29": {
            "text": "12 , T 12 X test 12 ; \u03b2 max (\u03bb ), \u03bb ,Y test 12 {\u03b2 12 } i = arg min \u03b2 \u2208B i L i F i (X 12 , T 12 (X 12 ); \u03b2 , \u03bb ) ,Y 1and defined the final predictor function f 12 (X) to be used on fold 3 a\u015dY i (X) = F i (X, T 12 (X); {\u03b2 12 } i , {\u03bb 12 } i ) Y(X) = (\u0176 1 (X)\u0176 2 (X) . . .\u0176 9 (X)) f 12 (X) = E(Y |X) = m e 12 \u0176 (X) \u00b7 \u03b2 e",
            "latex": null,
            "type": "figure"
        },
        "FIGREF30": {
            "text": "overall interpretation of the results, considering objectives, limitations, results from similar studies, and other relevant evidence. about the availability of supplementary resources, such as study protocol, Web calculator, and data sets. the source of funding and the role of the funders for the present study.",
            "latex": null,
            "type": "figure"
        },
        "TABREF0": {
            "text": "Figure 1. Data sources and prediction pipeline. 1a: Flow chart for model fitting and deployment. 1b: Distribution of age and SIMD across different input EHR data sources prior to any exclusions, excluding death records (also see SupplementaryTable 1). Numbers show total number of records in each source, and figures show demographics of individuals in that source. All figures are drawn to the same scale. MH: mental health; inp.: inpatient; A&E: accident and emergency; Other: geriatric long stay and System Watch data; ger.: geriatric long stay; syst.: System Watch. 1c: Demographics of individuals in different patient cohorts: the whole Scottish population, those present in at least one input EHR table, our study cohort and our cohort after stratifying by EA status. LTC denotes long-term conditions (e.g. epilepsy). The cohort with 'any EHR' includes deceased and otherwise excluded individuals from our study cohort. Data for the Scottish population is from the 2011 Census",
            "latex": null,
            "type": "table"
        },
        "TABREF4": {
            "text": "Vol. 1. World Health Organization, 2004. [25] Fatemeh Rahimian et al. \"Predicting the risk of emergency admission with machine learning: Development and validation using linked electronic health records\". In: PLoS medicine 15.11 (2018), e1002695. [26] Colin Sanderson and Jennifer Dixon. \"Conditions for which onset or hospital admission is potentially preventable by timely and effective ambulatory care\". In: Journal of health services research & policy 5.4 (2000), pp. 222-230. [27] Matthew Sperrin et al. \"Explicit causal reasoning is needed to prevent prognostic models being victims of their own success\". In: Journal of the American Medical Informatics Association 26.12 (2019), pp. 1675-1676.",
            "latex": null,
            "type": "table"
        },
        "TABREF5": {
            "text": "Supplementary materialOur supplementary material comprises 1.Table 1: Data sources, 2. Table 2: All predictors and definitions 3.",
            "latex": null,
            "type": "table"
        },
        "TABREF9": {
            "text": "Predictors and target used in SPARRA v4 model. Variable name is the name used in any code. Int: integer; Bin: binary",
            "latex": null,
            "type": "table"
        },
        "TABREF11": {
            "text": "Areas under ROC curves and PR curves by fold for each constituent predictor and ensemble. Columns 'Coef.' indicate coefficients in the ensemble. For models, 'max' indicates maximum depth. All standard errors for AUROCs are <",
            "latex": null,
            "type": "table"
        },
        "TABREF12": {
            "text": "Antihist, Hyposensit & Allergic EmergenAtopy Drugs Acting On The Nose Corti'roids & Other Anti-Inflamm.Preps.Drugs Used In Nausea And Vertigo Drugs Used In Neuromuscular Disorders Anti-Arrhythmic DrugsAll rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "table"
        },
        "TABREF13": {
            "text": "All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "table"
        },
        "TABREF14": {
            "text": "Corti'roids & Other Anti-Inflamm.Preps. Tissue Disorders & Topical Pain RelAntiepileptic DrugsCentral nervous system disease Drugs Used In Park'ism/Related Disorders CNS Stimulants and drugs used for ADHD Antispasmod.&Other Drgs Alt.Gut Motility All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "table"
        },
        "TABREF19": {
            "text": "Number of catheter prescriptionsNumber of prescriptiosn for drugs used in Parkinsonism and related disordersYears since first epilepsy diagnosisNumber of prescriptions for drugs used in neuromuscular disordersNumber of prescriptions for drugs affecting intestinal secretionsFigure 20. Influence profile on risk scores by variable and value, in decreasing order of mean absolute Shapley value. Vertical lines show standard deviations. Y axes are identical in all plots. Data are anonymised to have > 10 individuals for each x axis mark, so some X axis spacings are irregular. Plots are not shown if data are not sufficiently anonymous All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "table"
        },
        "TABREF20": {
            "text": "Identify the study as developing and/or validating a multivariable prediction model, the target population, and the outcome to be pre-Explain the medical context (including whether diagnostic or prognostic) and rationale for developing or validating the multivariable prediction model, including references to existing models. Specify the objectives, including whether the study describes the development or validation of the model or both. Describe the study design or source of data (e.g., randomized trial, cohort, or registry data), separately for the development and validation data sets, if applicable. Specify the key study dates, including start of accrual; end of accrual; and, if applicable, end of follow-up. Specify key elements of the study setting (e.g., primary care, secondary care, general population) including number and location of centres. Clearly define the outcome that is predicted by the prediction model, including how and when assessed. Report any actions to blind assessment of the outcome to be predicted. Clearly define all predictors used in developing or validating the multivariable prediction model, including how and when they were measured. Report any actions to blind assessment of predictors for the outcome and other predictors. Describe how missing data were handled (e.g., complete-case analysis, single imputation, multiple imputation) with details of any imputation method. Specify type of model, all model-building procedures (including any predictor selection), and method for internal validation. Specify all measures used to assess model performance and, if relevant, to compare multiple models. For validation, identify any differences from the development data in setting, eligibility criteria, outcome, and predictors. All rights reserved. No reuse allowed without permission.",
            "latex": null,
            "type": "table"
        },
        "TABREF21": {
            "text": "; https://doi.org/10.1101/2021.08.06.21261593 doi: medRxiv preprint Results 13a D;V Describe the flow of participants through the study, including the number of participants with and without the outcome and, if applicable, a summary of the follow-up time. A diagram may be helpful. Describe the characteristics of the participants (basic demographics, clinical features, available predictors), including the number of participants with missing data for predictors and outcome. For validation, show a comparison with the development data of the distribution of important variables (demographics, predictors and outcome). Present the full prediction model to allow predictions for individuals (i.e., all regression coefficients, and model intercept or baseline survival at a given time point). If done, report the results from any model updating (i.e., model specification, model performance). Discuss any limitations of the study (such as nonrepresentative sample, few events per predictor, missing data). 19a V For validation, discuss the results with reference to performance in the development data, and any other validation data.",
            "latex": null,
            "type": "table"
        }
    },
    "back_matter": [
        {
            "text": "The authors note that this project's success was entirely contingent on close co-operation between the Alan Turing Institute (JL, GB, NC, SV, LA, CV) and Public Health Scotland (RP, JI, DC, KB, SH, KP, SO, SR). We thank all individuals involved in primary care in Scotland for the continued support of the SPARRA project, as well as the general Scottish population.Authorial contributions were as follows: ",
            "cite_spans": [],
            "ref_spans": [],
            "section": "ACKNOWLEDGEMENTS"
        },
        {
            "text": "In all plots in this paper, we bounded bias under the assumption that there existed k such that |c p (z) \u2212 kz| < z 2 /10.The calibration estimator derived here is demonstrated in an R script sparra calibration.R available with the attached R code for this manuscript.",
            "cite_spans": [],
            "ref_spans": [],
            "section": "annex"
        }
    ]
}